\documentclass[18pt]{beamer}
\usepackage[utf8]{inputenc}
\usepackage{xcolor}
\usepackage{hyperref}
\usepackage{templates/mytemplate}
\usepackage{templates/beamerthemekit}
\usepackage{graphicx}
\usepackage{microtype}
\usepackage{listings}
\usepackage{multicol}
\usepackage{siunitx}
\usepackage{physics}
\usepackage{appendixnumberbeamer}
\usepackage{booktabs}
\usepackage{longtable}
\usepackage{amssymb}
\usepackage{todonotes}

\usepackage{paralist}
\let\itemize\compactitem
\let\description\compactdesc
\let\enumerate\compactenum  

\lstset{ %
  backgroundcolor=\color{white},   % choose the background color; you must add \usepackage{color} or \usepackage{xcolor}; should come as last argument
  basicstyle=\tiny\ttfamily,
  xleftmargin=-10pt,
  breaklines=false,                 % sets automatic line breaking
  captionpos=b,                    % sets the caption-position to bottom
  % frame=single,	                   % adds a frame around the code
  keepspaces=true,                 % keeps spaces in text, useful for keeping indentation of code (possibly needs columns=flexible)
  language=C++,                 % the language of the code
  % morekeywords={*,...},            % if you want to add more keywords to the set
  tabsize=2,	                   % sets default tabsize to 2 spaces
  keywordstyle=\bfseries\color{kit-green70},
  commentstyle=\itshape\color{kit-blue70},
  identifierstyle=\color{black},
  stringstyle=\color{kit-orange100},  
}

\hypersetup{colorlinks=true, urlcolor=kit-blue100, %linkcolor=Firebrick4
}

\title{Estimation of the Track Finding Efficiency using Cosmics Data} 
\subtitle{ETP Belle 2 Weekly Meeting}
\author{\underline{Michael Eliachevitch}}
\date{8 November 2018}
\titleimage{transparent}
\institute{ETP -- KIT}


\begin{document}
\selectlanguage{english}

\section{Introduction}
\begin{frame}
  \titlepage
\end{frame}

\begin{frame}
  \frametitle{Overview}
  \begin{itemize}
  \item look at track parameter distributions for new GCR data
  \item 
  \end{itemize}
  
\end{frame}

\begin{frame}
  \frametitle{Update on used Cosmics Data and MC}
  \begin{itemize}
  \item last F2F: used data from Juli GCR and my own MC without trigger simulation
  \item \textbf{current data:} GCR August 2017  with single TSF trigger
  \item \textbf{current MC:} GCR August MC ``sample 1'' from DP group: single TSF trigger simulation and narrow acceptbox around IP ($\SI{60}{cm} \times \SI{20}{cm} \times \SI{20}{\cm}$)
    \begin{itemize}
    \item in spite of trigger simulation, track parameter distributions still different  for data and MC due to narrow acceptbox (especially $z_0$)
    \item MC ``sample 2'' with wide acceptbox has become available last week, but could not be analysed until this F2F
    \end{itemize}
  \item Further information on datataking and MC production can be found at the confluence pages for
    \href{https://confluence.desy.de/display/BI/Data+Production+Global+Cosmics+Run+Data\#DataProductionGlobalCosmicsRunData-Runinfo}{data}
    and \href{https://confluence.desy.de/display/BI/Data+Production+Global+Cosmics+Run+MC}{MC}
  \end{itemize}    
\end{frame}

\begin{frame}
  \frametitle{Track Parameter Distributions in August GCR and MC}
  \begin{center}
    \includegraphics[width=0.3\textwidth]{figures/distributions/gcr_august_2017_pt_distribution_normed=True.pdf}
    \includegraphics[width=0.3\textwidth]{figures/distributions/gcr_august_2017_z0_distribution_normed=True.pdf}
    \includegraphics[width=0.3\textwidth]{figures/distributions/gcr_august_2017_d0_distribution_normed=True.pdf}\\
    \includegraphics[width=0.3\textwidth]{figures/distributions/gcr_august_2017_phi0_distribution_normed=True.pdf}
    \includegraphics[width=0.3\textwidth]{figures/distributions/gcr_august_2017_tan_lambda_distribution_normed=True.pdf}
  \end{center}
MC generator acceptbox half widths:
    \begin{itemize}
    \item $z:$ 30\,cm
    \item $x, y:$ 10\,cm
    \end{itemize}

\end{frame}
    
\begin{frame}
  \frametitle{Reminder: Estimation of Finding Efficiency}
  \begin{itemize}
  \item typical cosmics event: single muon track, no secondaries
  \item cosmics passing through VXD volume create two \texttt{NonMergedRecoTracks}\\
    $\rightarrow$ in the following use those instead of merged \texttt{RecoTracks}
  \item idea: estimate finding efficiency from \textcolor{kit-red100}{finding fails} in events where \textcolor{kit-blue100}{two (findable) tracks are expected}
  \end{itemize}
  \begin{block}{}
    \begin{equation*}
      \label{eq:cosmic_eff}
      \text{finding efficiency} = \frac{N_\mathrm{2\ tracks\ found}}{\textcolor{kit-blue100}{N_\mathrm{2\ tracks\ expected}}}
      = 1 - \frac{\textcolor{kit-red100}{N_\mathrm{1\ track\ found}}}{\textcolor{kit-blue100}{N_\mathrm{2\ tracks\ expected}}}
    \end{equation*}             %
  \end{block}
  where $\textcolor{kit-red100}{N_\mathrm{1\ track\ found}}, N_\mathrm{2\ tracks\ found}, \in \textcolor{kit-blue100}{N_\mathrm{2\ tracks\ expected}}$.\\
  
  % \includegraphics[width=0.3\textwidth]{figures/b2display_example_1trackevt_cut.png}
\end{frame}

\begin{frame}
  \begin{center}
    \frametitle{Example Finding Fail Event}
    \begin{itemize}
    \item GCR August 2017 data, run 3902, event 13913
    \item \textcolor{kit-blue100}{blue: assigned RecoHits}, \textcolor{kit-red100}{red: unassigned reco hits}
    \item only one reco track found in upper half, finding fail in bottom half
    \end{itemize}
    \includegraphics[width=0.65\textwidth]{figures/b2display_screenshots/gcr_data_2017-08_run3902_evt13913_finding-fail-musterevent.png}
  \end{center}
\end{frame}

\begin{frame}
  \frametitle{Challenges}
  \begin{itemize}
  \item Select set of events with two findable track halves without knowledge of track finding results (e.g. track parameters)
  \item MC Tracks were not split in MC Track Finder, so there was no simple MC truth for the number of tracks
  \item Deal with differences in cosmics data and MC
  \end{itemize}
\end{frame}

\section{Necessary Steps to get the Finding Efficiency}
\begin{frame}
  % Vorgehen / Approach
  \frametitle{Approach}
  \begin{block}{Steps to get the Cosmics based Finding Efficiency}
  \begin{itemize}
  \item Select two datasets based on MC truth where we know that the event contains one / two tracks\\
    $\rightarrow$ use time between \texttt{CDCSimHit}s as MC truth
  \item Based on those, find good parameters to select events with two expected tracks on data. Optimize cuts for high ``purity''
  \item Further refinement? E.g. discard events based on unphysical difference in track parameters (e.g. $\Delta p_T$)
  \item In the resulting dataset, count events where only one track was found and create efficiency profiles
  \item Compare this for MC and data and with finding efficency from MC truth matching
  \end{itemize}
\end{block}

\end{frame}


\begin{frame}
  \frametitle{Use hit times for MC truth based selection of events with one or two tracks }
  \begin{itemize}
  \item no MC truth information if there should be one or two \texttt{NonMergedRecoTracks}
  \item use time $\Delta t$ between subsequent \texttt{CDCSimHit}s in \texttt{MCRecoTracks} as MC truth:
    $\text{hit\ distance} \approx c\cdot\Delta t$
  \end{itemize}
  \begin{columns}
    \begin{column}{0.4\textwidth}
      \only<1>{\includegraphics[width=1.\textwidth]{figures/delta_t/gcraugust_delta_t_max_linear_xmin=0.pdf}}
      \only<2->{\includegraphics[width=1.\textwidth]{figures/delta_t/gcraugust_delta_t_max_linear_annotated_xmin=0_split=30_maxhitdistance=5.pdf}}
    \end{column}

    \begin{column}{0.35\textwidth}
      \only<2->{
        \begin{itemize}
        \item $(c\Delta t)_\mathrm{max} < \SI{5}{\cm}$:\\\textcolor{kit-red100}{one track expected}
        \item $(c\Delta t)_\mathrm{max} > \SI{30}{\cm}$:\\\textcolor{kit-green100}{two tracks expected}
        \item inbetween: not sure
        \end{itemize}
      }
    \end{column}
    \begin{column}{0.25\textwidth}
      \includegraphics[width=\textwidth]{figures/b2display_screenshots/gcr_mc_2017-08_run4006_evt1_twotrackevent_annotaded.pdf}
    \end{column}
  \end{columns}
\end{frame}




\begin{frame}
  \frametitle{Parameters for selection of  two track events on data}
  Parameters used to select expected two track events on data:
  \begin{itemize}
  \item number of CDC Hits in event
  \item sum of CDCHit y-positions
  \end{itemize}
  \begin{center}
    \includegraphics[width=0.45\textwidth]{figures/mcsplit_analysis/total_cdc_hits_gcraugust_30cm_split.pdf}
    \includegraphics[width=0.45\textwidth]{figures/mcsplit_analysis/sum_y_distribution_gcraugust_30cm_split.pdf}
  \end{center}
\end{frame}
  
\begin{frame}
  \begin{center}
    \includegraphics[width=0.72\textwidth]{figures/mcsplit_analysis/sum_y_vs_hits_merged_gcraugust_30cm_split.pdf}
  \end{center}
  \begin{block}{cuts to select two track events on data}
    \begin{itemize}
    \item $85 < \text{number of CDC hits} < 125$
    \item $\abs{\sum{y}} < \SI{400}{\cm}$
    \end{itemize}      
  \end{block}
  \begin{itemize}
    \item \textbf{``purity'': 99.8\%} of 358\,k one track events are not in this cut\\
    \item \textbf{``efficiency'': 43.8\%} of 1.288\,M two track events are in this cut
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Typical examples of excluded one track events}
  
  \begin{columns}
    \begin{column}{0.5\textwidth}
      \includegraphics[width=0.7\textwidth]{figures/b2display_screenshots/gcr_2017-08_run4182_evt7_onetrackevent_58cdchits_editet.png}\\
      58 CDC hits, lower than for two track events, because particle stopped at VXD
    \end{column}
    \begin{column}{0.5\textwidth}
      \includegraphics[width=0.7\textwidth]{figures/b2display_screenshots/gcr_2017-08_run4017_evt1_onetrackevent_170cdchits_edited.png}\\
      170 CDC hits, higher than for two track events, because there is no gap around VXD
    \end{column}
  \end{columns}
\end{frame}

\begin{frame}
  \frametitle{Further cuts based on $p_T$ difference between the two tracks}
  \begin{itemize}
  \item aim: exclude events where both found tracks are not related, but from different particles or secondary
  \item idea: require that $p_T$ is similar for both tracks
  \item problem: often bad fits due to low hit efficiencies
  \end{itemize}

  \begin{columns}
    \begin{column}{0.5\textwidth}
      \center
      \includegraphics[width=0.5\textwidth]{figures/b2display_screenshots/gcr_data_2017-08_run3912_evt964508_f57_two_unrelated_tracks.png}\\
      Looks like two independent particles
      \\$\Delta p_T \approx \SI{11}{\GeV}$
    \end{column}
    \begin{column}{0.5\textwidth}
      \center
      \includegraphics[width=0.5\textwidth]{figures/b2display_screenshots/gcr_data_2017-08_run3920_evt31009_two_tracks_found_but_bad_fit_r-phi.png}\\
      Same particle, but only few assigned hits in top half (dark blue), bad fit\\
      $\Delta p_T \approx \SI{17}{\GeV}$
    \end{column}
  \end{columns}
\end{frame}

\begin{frame}
  \frametitle{Types of events where my selection does not work yet}
  
\end{frame}

\begin{frame}
  \frametitle{Insight: QCS-R visible on $\Delta p_T$ between upper and lower tracks}
\end{frame}

\section{Results}
\begin{frame}
  \frametitle{Efficiency Plots}
  \includegraphics[width=0.7\textwidth]{figures/efficiency_study/cosmicbased_findeff_over_pt.pdf}
\end{frame}

\begin{frame}
    \includegraphics[width=0.7\textwidth]{figures/efficiency_study/cosmicbased_findeff_over_d0.pdf}\\
    \includegraphics[width=0.7\textwidth]{figures/efficiency_study/cosmicbased_findeff_over_z0.pdf}
  \end{frame}

\begin{frame}
  \includegraphics[width=0.7\textwidth]{figures/efficiency_study/cosmicbased_findeff_over_phi0.pdf}\\
  \includegraphics[width=0.7\textwidth]{figures/efficiency_study/cosmicbased_findeff_over_tan_lambda.pdf}
\end{frame}

\begin{frame}
  \frametitle{Discussion of my Results}
  
\end{frame}

\begin{frame}
  \frametitle{Outlook}
  \begin{itemize}
  \item Use cosmic muons to estimate hit efficiency
  \end{itemize}
\end{frame}

\section{Backup}

\begin{frame}
  \begin{center}
    \huge Backup
  \end{center}
\end{frame}



\begin{frame}
  \frametitle{Distribution of Hit $\Delta t$ for all hits in all tracks}  
  \begin{center}
    \includegraphics[width=0.45\textwidth]{figures/delta_t/gcraugust_delta_t_log.pdf}
  \end{center}
\end{frame}

\begin{frame}
  \frametitle{VXD dimensions}
  \includegraphics[width=0.8\textwidth]{figures/vxd_dimensions.pdf}\\
  Taken from Belle 2 technical design report (2010). All dimensions are given in mm.
\end{frame}

\begin{frame}
  \frametitle{Kinematic Distributions for Juli GCR}
  Data from Juli 2017 GCR and MC without trigger simulation
  \begin{center}
    \includegraphics[width=0.3\textwidth]{figures/distributions/gcr_juli_2017_pt_distribution_normed=True.pdf}
    \includegraphics[width=0.3\textwidth]{figures/distributions/gcr_juli_2017_z0_distribution_normed=True.pdf}
    \includegraphics[width=0.3\textwidth]{figures/distributions/gcr_juli_2017_d0_distribution_normed=True.pdf}\\
    \includegraphics[width=0.3\textwidth]{figures/distributions/gcr_juli_2017_phi0_distribution_normed=True.pdf}
    \includegraphics[width=0.3\textwidth]{figures/distributions/gcr_juli_2017_tan_lambda_distribution_normed=True.pdf}
  \end{center}
\end{frame}
  
\begin{frame}[fragile]
  \frametitle{Code for Splitting Tracks in MC Track Finder}
\begin{lstlisting}[language=C++]
std::vector< std::vector<TimeHitIDDetector> > hitsWithTimeAndDetectorInformationVectors;

if (m_splitAfterDeltaT < 0.0) { // no splitting, vector will only contain a single hitInformation vector
  hitsWithTimeAndDetectorInformationVectors.push_back(hitsWithTimeAndDetectorInformation);
} else { // split on delta t

  std::vector<TimeHitIDDetector>::size_type splitFromIdx = 0; // whenever splitting subtrack, start slice from this index
  for (std::vector<TimeHitIDDetector>::size_type i = 1; i != hitsWithTimeAndDetectorInformation.size(); i++) {

    double delta_t = (std::get<0>(hitsWithTimeAndDetectorInformation[i])
                      - std::get<0>(hitsWithTimeAndDetectorInformation[i - 1]));

    if (delta_t > m_splitAfterDeltaT) {
      // push slice of `hitsWithTimeAndDetectorInformation' between splitFromidx  and previous index
      hitsWithTimeAndDetectorInformationVectors
      .emplace_back(hitsWithTimeAndDetectorInformation.begin() + splitFromIdx,
                    hitsWithTimeAndDetectorInformation.begin() + i);
      splitFromIdx = i;
    }
  }
  // add subtrack after last splitting to list of tracks
  hitsWithTimeAndDetectorInformationVectors
  .emplace_back(hitsWithTimeAndDetectorInformation.begin() + splitFromIdx,
                hitsWithTimeAndDetectorInformation.end());
}
\end{lstlisting}
\end{frame}


\end{document}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: t
%%% End:
